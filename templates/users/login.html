{% extends 'users/base.html' %}
{% block title %}Login | MediConnect {% endblock title %}
{% load static %}

{% block content %}

<link rel="stylesheet" href="{% static 'css/login.css' %}">

<div class="topcontainer">
  <div class="login-container">
    <h1>Login</h1>

    <form method="POST" class="needs-validation" novalidate autocomplete="off" id="loginForm">
      {% csrf_token %}

      {% if messages %}
      {% for message in messages %}
      <div class="alert alert-danger alert-dismissible fade show mt-3" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
      {% endfor %}
      {% endif %}

      <div class="mb-3">
        <label class="mb-2 text-muted" for="id_user">Username</label>
        <input id="email" type="text" class="form-control" name="username" placeholder="User Name" required autofocus>
        <div class="invalid-feedback error-message">User Name is invalid</div>
      </div>

      <div class="mb-3 password-wrapper">
        <label class="mb-2 text-muted" for="id_user">Password</label>
        <input id="password" type="password" class="form-control" name="password" placeholder="Password" required>
        <i class="fa fa-eye eye-icon" id="togglePassword"></i>
        <div class="invalid-feedback error-message">Password is required</div>
      </div>

      <a href="{% url 'password-reset' %}" class="forgot-password">Forgot Password?</a>

      <button type="submit" class="btn btn-login mt-3">Login</button>
    </form>

    <a href="{% url 'register' %}" class="signup-link">Don't have an account? Sign Up</a>
  </div>
</div>

<script>
  (function () {
    'use strict'

    var forms = document.querySelectorAll('.needs-validation')

    Array.prototype.slice.call(forms)
      .forEach(function (form) {
        form.addEventListener('submit', function (event) {
          if (!form.checkValidity()) {
            event.preventDefault()
            event.stopPropagation()
          }

          form.classList.add('was-validated')
        }, false)
      })
  })()

  document.getElementById('loginForm').addEventListener('submit', function (event) {
    event.preventDefault();

    const errorMessages = document.querySelectorAll('.error-message');
    errorMessages.forEach(function (message) {
      message.style.display = 'none';
    });

    let valid = true;

    const username = document.getElementById('email');
    const password = document.getElementById('password');

    if (!username.value) {
      document.querySelector('#email + .error-message').style.display = 'block';
      valid = false;
    }

    if (!password.value) {
      document.querySelector('#password + .error-message').style.display = 'block';
      valid = false;
    }

    if (valid) {
      this.submit();  
    }
  });

  const togglePassword = document.getElementById('togglePassword');
  const passwordField = document.getElementById('password');

  togglePassword.addEventListener('click', function () {

    const type = passwordField.type === 'password' ? 'text' : 'password';
    passwordField.type = type;

    this.classList.toggle('fa-eye-slash');
  });
</script>

{% endblock content %}
